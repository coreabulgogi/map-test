<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kakao Map - Multiple Markers</title>
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6956432726c3dc8f834ab6cf0dea4cd4"></script>
</head>
<body>

  <h1>í”„ë¡œ-ìŠ¤í™ìŠ¤ ë§¤ì¥í˜„í™©(25.03ê¸°ì¤€)_Made by JeongHyeon</h1>
  <div id="map" style="width:1000px;height:800px;"></div>

  <script>
    var container = document.getElementById('map');
    var options = {
      center: new kakao.maps.LatLng(36.4074, 128.1565),
      level: 12
    };

    var map = new kakao.maps.Map(container, options);

    var positions = [
      { title: "ê´‘ì£¼ì¶©ì¥ë¡œì§ì˜ì ", latlng: new kakao.maps.LatLng(35.1492, 126.9146) },
      { title: "ë…¸ì›ì§ì˜ì ", latlng: new kakao.maps.LatLng(37.6532, 127.0613) },
      { title: "êµ°ì‚°ìˆ˜ì†¡ì§ì˜ì ", latlng: new kakao.maps.LatLng(35.9684, 126.7151) },
      { title: "ì˜¤ë¦¬ì§€ë„ìŠ¤í¬ì¸ í•œë‚¨ì§ì˜ì ", latlng: new kakao.maps.LatLng(37.5363, 127.0007) }
    ];

    var markers = [];

    // ğŸ”¹ ë” ë¶€ë“œëŸ¬ìš´ ì í”„ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
    function smoothJump(marker) {
      var startPosition = marker.getPosition();
      var step = 0.00005; // í•œ ë²ˆì— ì›€ì§ì´ëŠ” ê±°ë¦¬ (ê°’ì´ ì‘ì„ìˆ˜ë¡ ë¶€ë“œëŸ¬ì›€)
      var upPosition = new kakao.maps.LatLng(
        startPosition.getLat() - 0.0003,
        startPosition.getLng()
      );

      var count = 0;
      var interval = setInterval(() => {
        var newLat = startPosition.getLat() - step * count;
        marker.setPosition(new kakao.maps.LatLng(newLat, startPosition.getLng()));
        
        count++;

        if (count > 6) { // 6ë‹¨ê³„ì— ê±¸ì³ ì´ë™ (0.4ì´ˆ)
          clearInterval(interval);
          setTimeout(() => {
            marker.setPosition(startPosition);
          }, 200);
        }
      }, 50); // 50ms ê°„ê²©ìœ¼ë¡œ ì´ë™ (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜)
    }

    positions.forEach(function(pos) {
      var marker = new kakao.maps.Marker({
        map: map,
        position: pos.latlng,
        title: pos.title
      });

      var infowindow = new kakao.maps.InfoWindow({
        content: `<div style="padding:5px;">${pos.title}</div>`
      });

      markers.push({
        marker: marker,
        infowindow: infowindow,
        isOpen: false
      });

      kakao.maps.event.addListener(marker, "click", function() {
        var markerData = markers.find(m => m.marker === marker);
        if (markerData.isOpen) {
          markerData.infowindow.close();
        } else {
          markerData.infowindow.open(map, marker);
        }
        markerData.isOpen = !markerData.isOpen;

        // ğŸ”¹ ë¶€ë“œëŸ¬ìš´ ì í”„ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
        smoothJump(marker);
      });
    });

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var lat = position.coords.latitude;
        var lon = position.coords.longitude;
        var locPosition = new kakao.maps.LatLng(lat, lon);
        
        var markerImage = new kakao.maps.MarkerImage(
          "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
          new kakao.maps.Size(24, 35),
          { offset: new kakao.maps.Point(12, 35) }
        );

        var userMarker = new kakao.maps.Marker({
          map: map,
          position: locPosition,
          title: "í˜„ì¬ ìœ„ì¹˜",
          image: markerImage
        });

        var userInfowindow = new kakao.maps.InfoWindow({
          content: "<div style='padding:5px;'>í˜„ì¬ ìœ„ì¹˜</div>"
        });

        var isUserInfoOpen = false;

        kakao.maps.event.addListener(userMarker, 'click', function() {
          if (isUserInfoOpen) {
            userInfowindow.close();
          } else {
            userInfowindow.open(map, userMarker);
          }
          isUserInfoOpen = !isUserInfoOpen;

          // ğŸ”¹ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ë„ ì í”„ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
          smoothJump(userMarker);
        });

        // ğŸ”¹ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ê°€ ì²˜ìŒ ë‚˜íƒ€ë‚  ë•Œ ì í”„ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
        setTimeout(() => {
          smoothJump(userMarker);
        }, 1000);

      }, function(error) {
        alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      });
    } else {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
  </script>

</body>
</html>
